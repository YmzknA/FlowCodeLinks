# プルリクエスト: ERBメソッド検出と変数フィルタリング機能の実装

## 概要
本プルリクエストでは、ERBファイルのメソッド検出機能と、2段階解析による変数フィルタリング機能を実装しました。これにより、RailsアプリケーションのERBビューファイルからも正確にメソッド呼び出しを検出し、変数を除外した精度の高い依存関係の可視化が可能になります。

## 主な変更点

### 1. ERBファイルのメソッド検出機能
- **新機能**: ERBファイル(`.html.erb`)からRubyメソッド呼び出しを検出
- **対象**: ERBタグ(`<%= %>`, `<% %>`)内のRubyコード
- **検出パターン**: フォームヘルパー、URLヘルパー、ビューヘルパーなど

### 2. 2段階解析による変数フィルタリング
- **第1段階**: 全ファイルからメソッド定義名を抽出
- **第2段階**: 定義済みメソッド一覧を使って変数をフィルタリング

### 3. Rails標準メソッドの対応
- **新機能**: Rails標準メソッドリストを追加（約100種類）
- **対象**: フォームヘルパー、URLヘルパー、ビューヘルパー、認証メソッドなど

## 技術的な改良点

### SOLID原則への準拠
- **単一責任の原則**: メソッド抽出とフィルタリングを分離
- **開放閉鎖の原則**: 新しい言語サポートを容易に追加可能
- **リスコフの置換原則**: 各言語アナライザーが共通インターフェースを実装
- **インターフェース分離**: メソッド定義抽出とメソッド呼び出し検出を分離
- **依存関係逆転**: 設定ファイルで標準メソッドを管理

### DRY原則への準拠
- **共通パターン**: 正規表現パターンを統一
- **重複排除**: メソッド検出ロジックの共通化
- **設定の一元化**: Ruby/Railsキーワードの設定ファイル化

## パフォーマンス改良

### 解析処理の最適化
- **2段階解析**: 必要な情報のみを段階的に抽出
- **効率的なフィルタリング**: Set型を使用した高速な定義済みメソッド検索
- **重複除去**: 同一メソッド呼び出しの重複を排除

### メモリ使用量の削減
- **不要なデータ排除**: 変数として判定された名前を除外
- **効率的なデータ構造**: Map型を使用した効率的な集計

## 今後の運用における考慮点

### 長期運用の観点
- **スケーラビリティ**: 大規模プロジェクトでも効率的な解析が可能
- **保守性**: 新しいRailsメソッドの追加が容易
- **拡張性**: 他のテンプレートエンジン（Haml、Slim）への対応準備

### 品質保証
- **型安全性**: TypeScriptによる型チェック
- **テストカバレッジ**: 新機能の包括的なテスト
- **エラーハンドリング**: 不正なERBファイルの適切な処理

## 修正が必要な箇所

### 現在の実装で検討すべき点
1. **ERBファイル内のRubyコード解析**: より複雑なRubyコードパターンへの対応
2. **パフォーマンス**: 大量のERBファイルがある場合のメモリ使用量
3. **国際化対応**: 日本語などの非ASCII文字を含むメソッド名への対応

### 今後の改善案
1. **Tree-sitter導入**: より正確なシンタックス解析
2. **キャッシュ機能**: 解析結果のキャッシュによる高速化
3. **設定の外部化**: Rails標準メソッドリストの設定ファイル化